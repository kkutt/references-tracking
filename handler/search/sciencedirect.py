#!/usr/bin/env python

# ScienceDirect search handler using URL Requests to Search API
# Full description: https://api.elsevier.com/documentation/SCIDIRSearchAPI.wadl
#
# Copyright 2017, Krzysztof Kutt

import json
import urllib.parse
import urllib.request


def perform_search(query_string):
    """
    Performs search with given query_string
    :param query_string: list of terms to search
    :return: json response with details
    """

    # prepare the basic search query
    search_data = dict()
    search_data['apiKey'] = '6f746649d61f3feee890b73eb579ebfd'
    search_data['query'] = query_string
    search_data['count'] = 10

    url_base = 'http://api.elsevier.com/content/search/scidir'
    full_url = url_base + '?' + urllib.parse.urlencode(search_data)

    # post the query
    search_response = urllib.request.urlopen(full_url)
    response_xml = search_response.read().decode('utf-8')
    return response_xml


def dummy_search():
    return '''{"search-results":{"opensearch:totalResults":"17119","opensearch:startIndex":"0","opensearch:itemsPerPage":"10","opensearch:Query":{"@role": "request", "@searchTerms": "asthma leukotrienes", "@startPage": "0"},"link": [{"@_fa": "true", "@href": "http://api.elsevier.com/content/search/scidir?start=0&count=10&query=asthma+leukotrienes&apiKey=6f746649d61f3feee890b73eb579ebfd", "@ref": "self", "@type": "application/json"},{"@_fa": "true", "@href": "http://api.elsevier.com/content/search/scidir?start=0&count=10&query=asthma+leukotrienes&apiKey=6f746649d61f3feee890b73eb579ebfd", "@ref": "first", "@type": "application/json"},{"@_fa": "true", "@href": "http://api.elsevier.com/content/search/scidir?start=10&count=10&query=asthma+leukotrienes&apiKey=6f746649d61f3feee890b73eb579ebfd", "@ref": "next", "@type": "application/json"},{"@_fa": "true", "@href": "http://api.elsevier.com/content/search/scidir?start=5990&count=10&query=asthma+leukotrienes&apiKey=6f746649d61f3feee890b73eb579ebfd", "@ref": "last", "@type": "application/json"}],"entry": [{"@_fa": "true", "link": [{"@_fa": "true", "@href": "http://api.elsevier.com/content/article/pii/S0091674916307965", "@ref": "self"},{"@_fa": "true", "@href": "http://www.sciencedirect.com/science/article/pii/S0091674916307965", "@ref": "scidir"}],"dc:identifier":"DOI:10.1016/j.jaci.2016.07.014","eid":"1-s2.0-S0091674916307965","prism:url":"http://api.elsevier.com/content/article/pii/S0091674916307965","dc:title":"Age dictates a steroid-resistant cascade of Wnt5a, transglutaminase 2, and leukotrienes in inflamed airways","dc:creator":"Katharina, Dietz","prism:publicationName":"Journal of Allergy and Clinical Immunology","prism:issn":"00916749","prism:volume":"139","prism:issueIdentifier":"4","prism:coverDate": [{"@_fa": "true", "$" :"2017-04-01"}],"prism:coverDisplayDate":"April 2017","prism:startingPage":"1343","prism:endingPage":"1354.e6","prism:doi":"10.1016/j.jaci.2016.07.014","openaccess":"0","openaccessArticle":false,"openArchiveArticle":false,"openaccessUserLicense":null,"pubType":"Mechanisms of allergy and clinical immunology","pii":"S0091-6749(16)30796-5","authors":{"author": [{"@_fa": "true", "given-name":"Katharina","surname":"Dietz"},{"@_fa": "true", "given-name":"Marta","surname":"de los Reyes Jiménez"},{"@_fa": "true", "given-name":"Eva S.","surname":"Gollwitzer"},{"@_fa": "true", "given-name":"Adam M.","surname":"Chaker"},{"@_fa": "true", "given-name":"Ulrich M.","surname":"Zissler"},{"@_fa": "true", "given-name":"Olof P.","surname":"Rådmark"},{"@_fa": "true", "given-name":"Hoeke A.","surname":"Baarsma"},{"@_fa": "true", "given-name":"Melanie","surname":"Königshoff"},{"@_fa": "true", "given-name":"Carsten B.","surname":"Schmidt-Weber"},{"@_fa": "true", "given-name":"Benjamin J.","surname":"Marsland"},{"@_fa": "true", "given-name":"Julia","surname":"Esser-von Bieren"}]},"prism:teaser":"Airway remodeling is a detrimental and refractory process showing age-dependent clinical manifestations that are mechanistically undefined. The leukotriene (LT) and wingless/integrase (Wnt) pathways..."},{"@_fa": "true", "link": [{"@_fa": "true", "@href": "http://api.elsevier.com/content/article/pii/S1570023214001627", "@ref": "self"},{"@_fa": "true", "@href": "http://www.sciencedirect.com/science/article/pii/S1570023214001627", "@ref": "scidir"}],"dc:identifier":"DOI:10.1016/j.jchromb.2014.02.059","eid":"1-s2.0-S1570023214001627","prism:url":"http://api.elsevier.com/content/article/pii/S1570023214001627","dc:title":"Liquid chromatography–mass spectrometry measurement of leukotrienes in asthma and other respiratory diseases","dc:creator":"Paolo, Montuschi","prism:publicationName":"Journal of Chromatography B","prism:issueName":"Analysis of Eicosanoids, Amino Acids, Organic Acids and microRNA","prism:issn":"15700232","prism:volume":"964","prism:issueIdentifier":null,"prism:coverDate": [{"@_fa": "true", "$" :"2014-08-01"}],"prism:coverDisplayDate":"1 August 2014","prism:startingPage":"12","prism:endingPage":"25","prism:doi":"10.1016/j.jchromb.2014.02.059","openaccess":"0","openaccessArticle":false,"openArchiveArticle":false,"openaccessUserLicense":null,"pii":"S1570-0232(14)00162-7","authors":{"author": [{"@_fa": "true", "given-name":"Paolo","surname":"Montuschi"},{"@_fa": "true", "given-name":"Giuseppe","surname":"Santini"},{"@_fa": "true", "given-name":"Salvatore","surname":"Valente"},{"@_fa": "true", "given-name":"Chiara","surname":"Mondino"},{"@_fa": "true", "given-name":"Francesco","surname":"Macagno"},{"@_fa": "true", "given-name":"Paola","surname":"Cattani"},{"@_fa": "true", "given-name":"Gina","surname":"Zini"},{"@_fa": "true", "given-name":"Nadia","surname":"Mores"}]},"prism:teaser":"Leukotrienes (LTs), including cysteinyl-LTs (LTC4, LTD4 and LTE4) and LTB4, are potent inflammatory lipid mediators which have been involved in the pathophysiology of respiratory diseases. LC–MS/MS..."},{"@_fa": "true", "link": [{"@_fa": "true", "@href": "http://api.elsevier.com/content/article/pii/S0954611113002266", "@ref": "self"},{"@_fa": "true", "@href": "http://www.sciencedirect.com/science/article/pii/S0954611113002266", "@ref": "scidir"}],"dc:identifier":"DOI:10.1016/j.rmed.2013.06.014","eid":"1-s2.0-S0954611113002266","prism:url":"http://api.elsevier.com/content/article/pii/S0954611113002266","dc:title":"Vascular endothelial growth factor and cysteinyl leukotrienes in sputum supernatant of patients with asthma","dc:creator":"Georgia, Papadaki","prism:publicationName":"Respiratory Medicine","prism:issn":"09546111","prism:volume":"107","prism:issueIdentifier":"9","prism:coverDate": [{"@_fa": "true", "$" :"2013-09-01"}],"prism:coverDisplayDate":"September 2013","prism:startingPage":"1339","prism:endingPage":"1345","prism:doi":"10.1016/j.rmed.2013.06.014","openaccess":"1","openaccessArticle":true,"openArchiveArticle":true,"openaccessUserLicense":"http://www.elsevier.com/open-access/userlicense/1.0/","pii":"S0954-6111(13)00226-6","authors":{"author": [{"@_fa": "true", "given-name":"Georgia","surname":"Papadaki"},{"@_fa": "true", "given-name":"Petros","surname":"Bakakos"},{"@_fa": "true", "given-name":"Konstantinos","surname":"Kostikas"},{"@_fa": "true", "given-name":"Georgios","surname":"Hillas"},{"@_fa": "true", "given-name":"Zoi","surname":"Tsilogianni"},{"@_fa": "true", "given-name":"Nikolaos G.","surname":"Koulouris"},{"@_fa": "true", "given-name":"Spyros","surname":"Papiris"},{"@_fa": "true", "given-name":"Stelios","surname":"Loukides"}]},"prism:teaser":"Vascular endothelial growth factor (VEGF) is considered to be the most important angiogenic factor in asthma. Cysteinyl leukotrienes (Cyst-LTs) have been implicated in vascular permeability in asthma...."},{"@_fa": "true", "link": [{"@_fa": "true", "@href": "http://api.elsevier.com/content/article/pii/S0731708513001441", "@ref": "self"},{"@_fa": "true", "@href": "http://www.sciencedirect.com/science/article/pii/S0731708513001441", "@ref": "scidir"}],"dc:identifier":"DOI:10.1016/j.jpba.2013.03.026","eid":"1-s2.0-S0731708513001441","prism:url":"http://api.elsevier.com/content/article/pii/S0731708513001441","dc:title":"Immunomagnetic molecular probe with UHPLC–MS/MS: A promising way for reliable bronchial asthma diagnostics based on quantification of cysteinyl leukotrienes","dc:creator":"Kamila, Syslová","prism:publicationName":"Journal of Pharmaceutical and Biomedical Analysis","prism:issn":"07317085","prism:volume":"81–82","prism:issueIdentifier":null,"prism:coverDate": [{"@_fa": "true", "$" :"2013-07-01"}],"prism:coverDisplayDate":"July–August 2013","prism:startingPage":"108","prism:endingPage":"117","prism:doi":"10.1016/j.jpba.2013.03.026","openaccess":"0","openaccessArticle":false,"openArchiveArticle":false,"openaccessUserLicense":null,"pii":"S0731-7085(13)00144-1","authors":{"author": [{"@_fa": "true", "given-name":"Kamila","surname":"Syslová"},{"@_fa": "true", "given-name":"Adéla","surname":"Böhmová"},{"@_fa": "true", "given-name":"Elvan","surname":"Demirbağ"},{"@_fa": "true", "given-name":"Kateřina","surname":"Šimková"},{"@_fa": "true", "given-name":"Marek","surname":"Kuzma"},{"@_fa": "true", "given-name":"Daniela","surname":"Pelclová"},{"@_fa": "true", "given-name":"Vratislav","surname":"Sedlák"},{"@_fa": "true", "given-name":"Petr","surname":"Čáp"},{"@_fa": "true", "given-name":"Pavel","surname":"Martásek"},{"@_fa": "true", "given-name":"Petr","surname":"Kačer"}]},"prism:teaser":"A sensitive and precise method for simultaneous quantification of cysteinyl leukotrienes (=cys LTs) – leukotriene C4 (=LTC4), leukotriene D4 (=LTD4) and leukotriene E4 (=LTE4) – essential biomarkers..."},{"@_fa": "true", "link": [{"@_fa": "true", "@href": "http://api.elsevier.com/content/article/pii/S0021915016301447", "@ref": "self"},{"@_fa": "true", "@href": "http://www.sciencedirect.com/science/article/pii/S0021915016301447", "@ref": "scidir"}],"dc:identifier":"DOI:10.1016/j.atherosclerosis.2016.04.013","eid":"1-s2.0-S0021915016301447","prism:url":"http://api.elsevier.com/content/article/pii/S0021915016301447","dc:title":"Urinary cysteinyl leukotrienes in one-year follow-up of percutaneous transluminal angioplasty for peripheral arterial occlusive disease","dc:creator":"P, Maga","prism:publicationName":"Atherosclerosis","prism:issn":"00219150","prism:volume":"249","prism:issueIdentifier":null,"prism:coverDate": [{"@_fa": "true", "$" :"2016-06-01"}],"prism:coverDisplayDate":"June 2016","prism:startingPage":"174","prism:endingPage":"180","prism:doi":"10.1016/j.atherosclerosis.2016.04.013","openaccess":"0","openaccessArticle":false,"openArchiveArticle":false,"openaccessUserLicense":null,"pii":"S0021-9150(16)30144-7","authors":{"author": [{"@_fa": "true", "given-name":"P","surname":"Maga"},{"@_fa": "true", "given-name":"M","surname":"Sanak"},{"@_fa": "true", "given-name":"B","surname":"Rewerska"},{"@_fa": "true", "given-name":"M","surname":"Maga"},{"@_fa": "true", "given-name":"J","surname":"Jawien"},{"@_fa": "true", "given-name":"A","surname":"Wachsmann"},{"@_fa": "true", "given-name":"P","surname":"Rewerski"},{"@_fa": "true", "given-name":"W","surname":"Szczeklik"},{"@_fa": "true", "given-name":"N","surname":"Celejewska-Wójcik"}]},"prism:teaser":"Treatment of severe peripheral arterial occlusive disease requires percutaneous revascularization. However, little is known about risk factors or predictors for reocclusion/restenosis. Cysteinyl leukotrienes..."},{"@_fa": "true", "link": [{"@_fa": "true", "@href": "http://api.elsevier.com/content/article/pii/S0024320516302259", "@ref": "self"},{"@_fa": "true", "@href": "http://www.sciencedirect.com/science/article/pii/S0024320516302259", "@ref": "scidir"}],"dc:identifier":"DOI:10.1016/j.lfs.2016.04.005","eid":"1-s2.0-S0024320516302259","prism:url":"http://api.elsevier.com/content/article/pii/S0024320516302259","dc:title":"Investigations on the role of leukotrienes in remote hind limb preconditioning-induced cardioprotection in rats","dc:creator":"Baljeet, Singh","prism:publicationName":"Life Sciences","prism:issn":"00243205","prism:volume":"152","prism:issueIdentifier":null,"prism:coverDate": [{"@_fa": "true", "$" :"2016-05-01"}],"prism:coverDisplayDate":"1 May 2016","prism:startingPage":"238","prism:endingPage":"243","prism:doi":"10.1016/j.lfs.2016.04.005","openaccess":"0","openaccessArticle":false,"openArchiveArticle":false,"openaccessUserLicense":null,"pii":"S0024-3205(16)30225-9","authors":{"author": [{"@_fa": "true", "given-name":"Baljeet","surname":"Singh"},{"@_fa": "true", "given-name":"Puneet Kaur","surname":"Randhawa"},{"@_fa": "true", "given-name":"Nirmal","surname":"Singh"},{"@_fa": "true", "given-name":"Amteshwar Singh","surname":"Jaggi"}]},"prism:teaser":"The cardioprotective effects of remote hind limb preconditioning (RIPC) are well established, but its mechanisms still remain to be explored. Therefore, the present study was aimed to explore the possible..."},{"@_fa": "true", "link": [{"@_fa": "true", "@href": "http://api.elsevier.com/content/article/pii/S1098882315300186", "@ref": "self"},{"@_fa": "true", "@href": "http://www.sciencedirect.com/science/article/pii/S1098882315300186", "@ref": "scidir"}],"dc:identifier":"DOI:10.1016/j.prostaglandins.2015.12.001","eid":"1-s2.0-S1098882315300186","prism:url":"http://api.elsevier.com/content/article/pii/S1098882315300186","dc:title":"Role of leukotrienes in diabetic retinopathy","dc:creator":"Tapan, Behl","prism:publicationName":"Prostaglandins & Other Lipid Mediators","prism:issn":"10988823","prism:volume":"122","prism:issueIdentifier":null,"prism:coverDate": [{"@_fa": "true", "$" :"2016-01-01"}],"prism:coverDisplayDate":"January 2016","prism:startingPage":"1","prism:endingPage":"9","prism:doi":"10.1016/j.prostaglandins.2015.12.001","openaccess":"0","openaccessArticle":false,"openArchiveArticle":false,"openaccessUserLicense":null,"pubType":"Review","pii":"S1098-8823(15)30018-6","authors":{"author": [{"@_fa": "true", "given-name":"Tapan","surname":"Behl"},{"@_fa": "true", "given-name":"Ishneet","surname":"Kaur"},{"@_fa": "true", "given-name":"Anita","surname":"Kotwani"}]},"prism:teaser":"The pathophysiology of diabetic retinopathy is highly complex and encompasses the detrimental roles of numerous factors/mediators in inducing various molecular pathological alterations. Although the..."},{"@_fa": "true", "link": [{"@_fa": "true", "@href": "http://api.elsevier.com/content/article/pii/S1094553913001338", "@ref": "self"},{"@_fa": "true", "@href": "http://www.sciencedirect.com/science/article/pii/S1094553913001338", "@ref": "scidir"}],"dc:identifier":"DOI:10.1016/j.pupt.2013.06.003","eid":"1-s2.0-S1094553913001338","prism:url":"http://api.elsevier.com/content/article/pii/S1094553913001338","dc:title":"Cough, asthma, and cysteinyl-leukotrienes","dc:creator":"Akio, Niimi","prism:publicationName":"Pulmonary Pharmacology & Therapeutics","prism:issn":"10945539","prism:volume":"26","prism:issueIdentifier":"5","prism:coverDate": [{"@_fa": "true", "$" :"2013-10-01"}],"prism:coverDisplayDate":"October 2013","prism:startingPage":"514","prism:endingPage":"519","prism:doi":"10.1016/j.pupt.2013.06.003","openaccess":"0","openaccessArticle":false,"openArchiveArticle":false,"openaccessUserLicense":null,"pii":"S1094-5539(13)00133-8","authors":{"author": [{"@_fa": "true", "given-name":"Akio","surname":"Niimi"}]},"prism:teaser":"Asthma is a chronic inflammatory disease of the lower airways, involving various cells such as eosinophils, and cytokines and mediators. Cyteinyl-leukotrienes (cys-LTs) are one of the chemical mediators..."},{"@_fa": "true", "link": [{"@_fa": "true", "@href": "http://api.elsevier.com/content/article/pii/S0093691X15000369", "@ref": "self"},{"@_fa": "true", "@href": "http://www.sciencedirect.com/science/article/pii/S0093691X15000369", "@ref": "scidir"}],"dc:identifier":"DOI:10.1016/j.theriogenology.2015.01.021","eid":"1-s2.0-S0093691X15000369","prism:url":"http://api.elsevier.com/content/article/pii/S0093691X15000369","dc:title":"The influence of leukotrienes C4 and D4 on the contractility of an inflamed porcine uterus","dc:creator":"B., Jana","prism:publicationName":"Theriogenology","prism:issn":"0093691X","prism:volume":"83","prism:issueIdentifier":"8","prism:coverDate": [{"@_fa": "true", "$" :"2015-05-01"}],"prism:coverDisplayDate":"May 2015","prism:startingPage":"1328","prism:endingPage":"1337","prism:doi":"10.1016/j.theriogenology.2015.01.021","openaccess":"0","openaccessArticle":false,"openArchiveArticle":false,"openaccessUserLicense":null,"pubType":"Research article","pii":"S0093-691X(15)00036-9","authors":{"author": [{"@_fa": "true", "given-name":"B.","surname":"Jana"},{"@_fa": "true", "given-name":"J.J.","surname":"Jaroszewski"},{"@_fa": "true", "given-name":"J.","surname":"Czarzasta"},{"@_fa": "true", "given-name":"W.","surname":"Markiewicz"}]},"prism:teaser":"The effect of leukotriene (LT) C4 (LTC4) and LTD4 on the contractility of an inflamed porcine uterus was investigated. On Day 3 of the estrous cycle (Day 0 of the study), either saline or Escherichia..."},{"@_fa": "true", "link": [{"@_fa": "true", "@href": "http://api.elsevier.com/content/article/pii/S1877032010000850", "@ref": "self"},{"@_fa": "true", "@href": "http://www.sciencedirect.com/science/article/pii/S1877032010000850", "@ref": "scidir"}],"dc:identifier":"DOI:10.1016/j.reval.2010.02.018","eid":"1-s2.0-S1877032010000850","prism:url":"http://api.elsevier.com/content/article/pii/S1877032010000850","dc:title":"Apports des antileucotriènes dans le contrôle de l’asthme","dc:creator":"P., Demoly","prism:publicationName":"Revue Française d'Allergologie","prism:issn":"18770320","prism:volume":"50","prism:issueIdentifier":"4","prism:coverDate": [{"@_fa": "true", "$" :"2010-06-01"}],"prism:coverDisplayDate":"June 2010","prism:startingPage":"368","prism:endingPage":"374","prism:doi":"10.1016/j.reval.2010.02.018","openaccess":"0","openaccessArticle":false,"openArchiveArticle":false,"openaccessUserLicense":null,"pubType":"Revue critique","pii":"S1877-0320(10)00085-0","authors":{"author": [{"@_fa": "true", "given-name":"P.","surname":"Demoly"}]},"prism:teaser":"Le traitement de l’asthme repose sur la maîtrise de l’inflammation bronchique, clé de voûte de la physiopathologie de la maladie. Il a bénéficié ces 20 dernières années de nouveautés thérapeutiques..."}]}}'''


def handle_doc(doc):
    """
    Handles the json node representing one document in results
    :param doc: json node with document data
    :return: nothing
    """
    print("Title: {}".format(doc['dc:title']))
    print("Authors: ", end="")
    for author in doc['authors']['author']:
        print("{} {}".format(author['surname'], author['given-name']),
              end=" and ")
    print()
    if 'dc:identifier' in doc:
        print("DOI: {}".format(doc['dc:identifier']))
    else:
        print("DOI not available")


def handle_response(response_text):
    """
    Handles json response to extract the articles data
    :param response_text: string with json response 
    :return: nothing
    """
    response = json.loads(response_text)

    for doc in response['search-results']['entry']:
        handle_doc(doc)
        print('---------------------------')


if __name__ == '__main__':
    # response_json = perform_search("asthma leukotrienes")
    response_json = dummy_search()
    handle_response(response_json)
